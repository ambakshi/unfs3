CC = @CC@
CFLAGS = @CFLAGS@ -Wall -W
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
RM = rm -f
MAKE = make

SOURCES = attr.c daemon.c error.c fd_cache.c fh.c fh_cache.c locate.c \
          md5.c mount.c nfs.c password.c readdir.c user.c xdr.c
OBJS = attr.o daemon.o error.o fd_cache.o fh.o fh_cache.o locate.o \
       md5.o mount.o nfs.o password.o readdir.o user.o xdr.o
CONFOBJ = Config/lib.a
EXTRAOBJ = @EXTRAOBJ@
LDFLAGS = @LDFLAGS@ @LIBS@@LEXLIB@

prefix = @prefix@
exec_prefix = @exec_prefix@
sbindir = @sbindir@
mandir = @mandir@

SUBDIRS = Config @SUBDIRS@

DESTDIR =

all: subdirs unfsd

unfsd: $(OBJS) $(CONFOBJ) $(EXTRAOBJ)
	$(CC) -o $@ $(OBJS) $(CONFOBJ) $(EXTRAOBJ) $(LDFLAGS)

subdirs:
	for i in $(SUBDIRS); do cd $$i; $(MAKE) all; cd ..; done

install: unfsd
	$(INSTALL) -d $(DESTDIR)$(sbindir)
	$(INSTALL) -d $(DESTDIR)$(mandir)/man7
	$(INSTALL) -d $(DESTDIR)$(mandir)/man8
	$(INSTALL) unfsd         $(DESTDIR)$(sbindir)/unfsd
	$(INSTALL_DATA) Extras/tags.7 $(DESTDIR)$(mandir)/man7/tags.7
	$(INSTALL_DATA) unfsd.8       $(DESTDIR)$(mandir)/man8/unfsd.8

install-strip: install
	strip $(DESTDIR)$(sbindir)/unfsd

uninstall:
	$(RM) $(DESTDIR)$(sbindir)/unfsd
	$(RM) $(DESTDIR)$(mandir)/man7/tags.7
	$(RM) $(DESTDIR)$(mandir)/man8/unfsd.8

clean:
	for i in $(SUBDIRS); do cd $$i; $(MAKE) clean; cd ..; done
	$(RM) $(OBJS)
	$(RM) unfsd

distclean: clean
	for i in $(SUBDIRS); do cd $$i; $(MAKE) distclean; cd ..; done
	$(RM) Makefile config.h
	$(RM) config.log config.status

maintainer-clean: distclean
	$(RM) config.h.in configure
	$(RM) -rf autom4te.cache

dep: $(SOURCES)
	for i in $(SUBDIRS); do cd $$i; $(MAKE) dep; cd ..; done
	$(CC) $(CFLAGS) -MM $(SOURCES) >> Makefile

# automatically generated dependencies follow
